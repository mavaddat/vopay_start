<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Getting Started</title>

    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" media="screen" rel="stylesheet">
    <link href="slate/css/print.css" media="print" rel="stylesheet">
    <link href="slate/css/screen.css" media="screen" rel="stylesheet">
    <script src="slate/js/lib/jquery.min.js"></script>
    <script src="slate/js/lib/jquery.highlight.js"></script>
    <script src="slate/js/lib/energize.js"></script>
    <script src="slate/js/lib/imagesloaded.pkgd.min.js"></script>
    <script src="slate/js/lib/lunr.min.js"></script>
    <script src="slate/js/app/lang.js"></script>
    <script src="slate/js/app/toc.js"></script>
    
    <script src="slate/js/app/search.js"></script>
    
    
    <script src="slate/js/app/copy.js"></script>
    
    
    <script src="slate/js/app/autocaption.js"></script>
    
    <script type="text/javascript">
      function adjustLanguageSelectorWidth() {
        const elem = $('.dark-box > .lang-selector');
        elem.width(elem.parent().width());
      }
      $(function() {
        loadToc($('#toc'), '.toc-link', '.toc-list-h2, .toc-list-h3, .toc-list-h4, .toc-list-h5, .toc-list-h6', 10);
        setupLanguages($('body').data('languages'));
        $('.content').imagesLoaded( function() {
          recacheHeights();
          refreshToc();
        });
        $(window).resize(function() {
          adjustLanguageSelectorWidth();
        });
        adjustLanguageSelectorWidth();
      });
      window.onpopstate = function() {
        activateLanguage(getLanguageFromQueryString());
      };
    </script>
    <!-- slate; content for the head element from source/includes/head.ejs -->
<meta name="theme-color" content="#282a36">
<!-- TODO: import SASS variable $vopay-bg dynamically
    Check out https://www.npmjs.com/package/eleventy-plugin-styles -->
<script type="module" src="https://unpkg.com/rough-notation?module"></script>
<script defer="" type="module">
    import { annotate } from "https://unpkg.com/rough-notation?module";
    const KEY_SPAN = document.querySelector("#key");
    const SECRET_SPAN = document.querySelector("#secret");
    const DATE_SPAN = document.querySelector("#date");

    async function digestMessage(message) {
        const msgUint8 = new TextEncoder().encode(message); // encode as (utf-8) Uint8Array
        const hashBuffer = await crypto.subtle.digest("SHA-1", msgUint8); // hash the message
        const hashArray = Array.from(new Uint8Array(hashBuffer)); // convert buffer to byte array
        const hashHex = hashArray
            .map((b) => b.toString(16).padStart(2, "0"))
            .join(""); // convert bytes to hex string
        return hashHex;
    }

    const KEY_STR = KEY_SPAN.innerHTML;
    const SECRET_STR = SECRET_SPAN.innerHTML;
    const DATE_STR = new Date().toISOString().slice(0, 10);

    DATE_SPAN.innerHTML = DATE_STR;

    const preSig = KEY_STR + SECRET_STR + DATE_STR;
    const sig = document.querySelector("#signature");

    digestMessage(preSig).then((digestHex) => (sig.innerHTML = digestHex));

    const KEY_ANNO = annotate(KEY_SPAN, {
        type: "underline",
        color: "#ab228b",
        padding: 5
    });
    const SECRET_ANNO = annotate(SECRET_SPAN, {
        type: "circle",
        color: "red",
        padding: 5
    });
    const DATE_ANNO = annotate(DATE_SPAN, {
        type: "box",
        color: "orange",
        padding: 7
    });

    KEY_ANNO.show();
    SECRET_ANNO.show();
    DATE_ANNO.show();
    function updateGrid() {
        const keyWidth = KEY_SPAN.getBoundingClientRect().width;
        const secretWidth = SECRET_SPAN.getBoundingClientRect().width;
        const dateWidth = DATE_SPAN.getBoundingClientRect().width;
        const widths = {
            key: keyWidth,
            secret: secretWidth,
            date: dateWidth
        };
        const classes = ["above", "below"];
        const styles = ["width", "maxWidth"];
        for(let i in classes){
            let j = 0;
            let spans = document.querySelectorAll(`.${classes[i]} > span`); //3 spans
            for(let id in widths){
                for(let k in styles){
                    spans[j].style[styles[k]] = widths[id] + "px";
                }
                j++;
            }
        }
    }
    // wait for the spans to be rendered then call updateGrid
    window.addEventListener("load", updateGrid);
    // update the grid when the window is resized
    window.addEventListener("resize", updateGrid);
</script>

  </head>

  <body data-languages="[&quot;powershell&quot;,&quot;shell&quot;,&quot;ruby&quot;,&quot;python&quot;,&quot;php&quot;,&quot;csharp&quot;,&quot;javascript&quot;,&quot;java&quot;,&quot;go&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="slate/img/navbar.png" alt="Navigation">
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="slate/img/vopay.svg" alt="VoPay logo" class="logo">
      
        <div class="lang-selector">
          
            
              <a href="#" data-language-name="powershell">powershell</a>
            
          
            
              <a href="#" data-language-name="shell">shell</a>
            
          
            
              <a href="#" data-language-name="ruby">ruby</a>
            
          
            
              <a href="#" data-language-name="python">python</a>
            
          
            
              <a href="#" data-language-name="php">php</a>
            
          
            
              <a href="#" data-language-name="csharp">csharp</a>
            
          
            
              <a href="#" data-language-name="javascript">javascript</a>
            
          
            
              <a href="#" data-language-name="java">java</a>
            
          
            
              <a href="#" data-language-name="go">go</a>
            
          
        </div>
      
      
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      

      <div id="toc" class="toc-list-h1">
	  	<ul class="toc-list-h1">
        
          <li>
            <a href="#How-VoPay-Works" class="toc-h1 toc-link" data-title="How VoPay Works">How VoPay Works</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#Virtual-wallet" class="toc-h2 toc-link" data-title="">Virtual wallet</a>
                    
                  </li>
                
                  <li>
                    <a href="#Funds-flow-diagram" class="toc-h2 toc-link" data-title="">Funds flow diagram</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Fundamentals" class="toc-h1 toc-link" data-title="Fundamentals">Fundamentals</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#Authentication" class="toc-h2 toc-link" data-title="">Authentication</a>
                    
                  </li>
                
                  <li>
                    <a href="#Response-Readiness" class="toc-h2 toc-link" data-title="">Response Readiness</a>
                    
                  </li>
                
                  <li>
                    <a href="#Idempotent-requests" class="toc-h2 toc-link" data-title="">Idempotent requests</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Checking-your-VoPay-balance" class="toc-h1 toc-link" data-title="Checking your VoPay balance">Checking your VoPay balance</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#The-response-explained" class="toc-h2 toc-link" data-title="">The response explained</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Funding-your-VoPay-wallet" class="toc-h1 toc-link" data-title="Funding your VoPay wallet">Funding your VoPay wallet</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#Electronic-Funds-Transfer-EFT-Fund" class="toc-h2 toc-link" data-title="">Electronic Funds Transfer (EFT) Fund</a>
                    
                  </li>
                
                  <li>
                    <a href="#Interac-money-request" class="toc-h2 toc-link" data-title="">Interac money request</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Sending-money-from-your-VoPay-wallet" class="toc-h1 toc-link" data-title="Sending money from your VoPay wallet">Sending money from your VoPay wallet</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#EFT-Withdraw" class="toc-h2 toc-link" data-title="">EFT Withdraw</a>
                    
                  </li>
                
                  <li>
                    <a href="#Interac-e-transfer" class="toc-h2 toc-link" data-title="">Interac e-transfer</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#The-Transaction-lifecycle" class="toc-h1 toc-link" data-title="The Transaction lifecycle">The Transaction lifecycle</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#EFTs" class="toc-h2 toc-link" data-title="">EFTs</a>
                    
                  </li>
                
                  <li>
                    <a href="#Interac-Money-Request" class="toc-h2 toc-link" data-title="">Interac Money Request</a>
                    
                  </li>
                
                  <li>
                    <a href="#Interac-e-Transfer" class="toc-h2 toc-link" data-title="">Interac e-Transfer</a>
                    
                  </li>
                
                  <li>
                    <a href="#Polling-for-transaction-statuses" class="toc-h2 toc-link" data-title="">Polling for transaction statuses</a>
                    
                  </li>
                
                  <li>
                    <a href="#Webhook-notifications" class="toc-h2 toc-link" data-title="">Webhook notifications</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Scheduling-Transactions" class="toc-h1 toc-link" data-title="Scheduling Transactions">Scheduling Transactions</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#Scheduling-one-time-payments" class="toc-h2 toc-link" data-title="">Scheduling one-time payments</a>
                    
                  </li>
                
                  <li>
                    <a href="#Scheduling-recurring-payments" class="toc-h2 toc-link" data-title="">Scheduling recurring payments</a>
                    
                  </li>
                
                  <li>
                    <a href="#Scheduling-an-auto-balance-transfer" class="toc-h2 toc-link" data-title="">Scheduling an auto-balance transfer</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Aliasing-Sensitive-Data" class="toc-h1 toc-link" data-title="Aliasing Sensitive Data">Aliasing Sensitive Data</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#Overview-of-Token-Use-Cases" class="toc-h2 toc-link" data-title="">Overview of Token Use Cases</a>
                    
                  </li>
                
                  <li>
                    <a href="#Manually-generating-a-token" class="toc-h2 toc-link" data-title="">Manually generating a token</a>
                    
                  </li>
                
                  <li>
                    <a href="#Token-via-Customer-Login" class="toc-h2 toc-link" data-title="">Token via Customer Login</a>
                    
                  </li>
                
                  <li>
                    <a href="#Paylink-Invitation" class="toc-h2 toc-link" data-title="">Paylink Invitation</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Troubleshooting" class="toc-h1 toc-link" data-title="Troubleshooting">Troubleshooting</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#When-do-transactions-fail" class="toc-h2 toc-link" data-title="">When do transactions fail?</a>
                    
                  </li>
                
                  <li>
                    <a href="#Common-errors" class="toc-h2 toc-link" data-title="">Common errors</a>
                    
                  </li>
                
                  <li>
                    <a href="#Other-errors" class="toc-h2 toc-link" data-title="">Other errors</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Meta-transaction-requests" class="toc-h1 toc-link" data-title="Meta-transaction requests">Meta-transaction requests</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#Cancel" class="toc-h2 toc-link" data-title="">Cancel</a>
                    
                  </li>
                
                  <li>
                    <a href="#Refund" class="toc-h2 toc-link" data-title="">Refund</a>
                    
                  </li>
                
                  <li>
                    <a href="#Removing-Flags" class="toc-h2 toc-link" data-title="">Removing Flags</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#Client-Accounts" class="toc-h1 toc-link" data-title="Client Accounts">Client Accounts</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#What-are-client-accounts-and-how-can-we-use-them" class="toc-h2 toc-link" data-title="">What are client accounts and how can we use them</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
		</ul>
      </div>
      
        <ul class="toc-footer">
          
            <li><a href="https://vopay.com/api-sandbox/">Sign Up for a Developer Key</a></li>
          
        </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="How-VoPay-Works" tabindex="-1">How VoPay Works</h1>
<p><em>Welcome!</em> To quickly equip you to use VoPay’s APIs, get a sense of outbound parameters with typical response structure, this guide will walk you through making real queries and post transactions to a sandbox environment.</p>
<p>As a summary of how VoPay works, your VoPay account can be thought to be several secure, cloud-hosted wallets.</p>
<h2 id="Virtual-wallet" tabindex="-1">Virtual wallet</h2>
<p>Each currency has its own distinct wallet, hence transactions of differing currencies will fund the wallet of that currency. Your funds are available for transactions when they are transferred from a bank account into your VoPay wallet.</p>
<table>
<thead>
<tr>
<th>Currency</th>
<th>Wallet</th>
<th>Balance</th>
</tr>
</thead>
<tbody>
<tr>
<td>USD</td>
<td><img src="slate/img/usd_wallet.svg" alt="A visual representation of the wallet for U.S. dollars"></td>
<td>$700.00</td>
</tr>
<tr>
<td>CAD</td>
<td><img src="slate/img/cad_wallet.svg" alt="A visual representation of the wallet for Canadian dollars"></td>
<td>$1300.00</td>
</tr>
<tr>
<td>EUR</td>
<td><img src="slate/img/eur_wallet.svg" alt="A visual representation of the wallet for Euros"></td>
<td>€0.00</td>
</tr>
<tr>
<td>GBP</td>
<td><img src="slate/img/gbp_wallet.svg" alt="A visual representation of the wallet for British pound sterling"></td>
<td>£0.00</td>
</tr>
</tbody>
</table>
<aside class="caution">
Balances always refer to specific funds for a distinct currency.
</aside>
<script defer="" type="text/javascript">
    document.querySelector("div.content > table:nth-child(6) > tbody > tr:nth-child(3) > td:nth-child(3)").innerText = `€${Math.floor( Math.random()*1000)}.00`;
    document.querySelector("div.content > table:nth-child(6) > tbody > tr:nth-child(4) > td:nth-child(3)").innerText = `£${Math.floor( Math.random()*1000)}.00`;
</script>
<h2 id="Funds-flow-diagram" tabindex="-1">Funds flow diagram</h2>
<p>Consider the two wallets from the above section: $1,300 CAD, $700 USD. In this case, attempting to make an electronic funds transfer of $1,500 CAD would fail.</p>
<p><div class="autocaption"><figure><img src="./../slate/img/wallet_fail.svg" alt="Example of failed transaction due to insufficient funds in the target currency" class="autocaption"><figcaption>A $1500 CAD transaction fails because Canadian funds are insufficient.</figcaption></figure></div></p>
<p>This situation can be remedied by funding your wallet in your target currency prior to the transaction.</p>
<p><div class="autocaption"><figure><img src="./../slate/img/wallet_success.svg" alt="Example of successful transaction" class="autocaption"><figcaption>The user funded their CAD wallet, now a $1500 CAD transaction succeeds.</figcaption></figure></div></p>
<h1 id="Fundamentals" tabindex="-1">Fundamentals</h1>
<p>VoPay authenticates, validates, and checks your request for possible duplication (to accomplish <a href="#Idempotent-requests">idempotency</a>).</p>
<p>Now you will learn how to provide the authenticating information for every request.</p>
<h2 id="Authentication" tabindex="-1">Authentication</h2>
<p>You will use the <strong>account ID</strong>, <strong>API key</strong> and a <strong>signature</strong> to authenticate each API request.</p>
<aside class="notice">When your account is activated, VoPay sends you an email containing your account ID, shared secret, and API key.</aside>
<p>To generate the signature, concatenate your API key and shared secret together with the current date, then hash the result using SHA1.</p>
<p><img src="slate/img/signaturediagram.svg" alt="Signature calculation process"></p>
<h3 id="Generating-your-signature" tabindex="-1">Generating your signature</h3>
<p>You will need to compute a signature from your VoPay credentials to authenticate every request you make.</p>
<aside class="notice">
Because producing the signature requires digesting the date, you need to re-calculate it each day. This <strong>daily signature</strong> will be a <em>method output</em> rather than a <em>static constant</em> in your solution.
</aside>
<p>By example, here is a shared secret and an API key with a current date:</p>
<div class="example-container">
    <code class="example-container above">
        <span>
            <img src="https://cdn.glitch.global/576f7a6a-1333-4479-915b-925c8ad0247a/apikey.svg?v=1644377138320">
        </span>
        <span></span>
        <span>
            <img src="https://cdn.glitch.global/576f7a6a-1333-4479-915b-925c8ad0247a/formatteddate.svg?v=1644378064628">
        </span>
    </code>
    <code class="strexample">
        <span id="key">3da541559918a808c2402bba5012f6c60b27661c</span>
        <span id="secret">OTEyZWM4MDNiMmNINDk=</span>
        <span id="date">2022-02-08</span>
    </code>
    <code class="example-container below">
        <span></span>
        <span>
            <img src="https://cdn.glitch.global/576f7a6a-1333-4479-915b-925c8ad0247a/sharedsecret.svg?v=164437805863">
        </span>
        <span></span>
    </code>
</div>
<p>Hashing the above string will produce the following signature:</p>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Hash</th>
</tr>
</thead>
<tbody>
<tr>
<td>SHA1</td>
<td><code id="signature">f69fe6fbd81b9008fbcc0ebdac5fc7a47e3beacf</code></td>
</tr>
</tbody>
</table>
<aside class="test">
See if you are able to reproduce the signature above using the code sample in your preferred language.
</aside>
<blockquote>
<p>SHA1 hash of the key, shared secret, formatted date ⇾ signature</p>
</blockquote>
<pre class="language-powershell"><code class="language-powershell"><span class="token comment"># $KEY = "3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token comment"># $SECRET = "OTEyZWM4MDNiMmNINDk="</span>
<span class="token variable">$AccountID</span> = <span class="token string">"alice.smith"</span>
<span class="token comment"># Securely read the credentials from the user</span>
<span class="token variable">$Credentials</span> = @<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$cred</span> in @<span class="token punctuation">(</span><span class="token string">"Key"</span><span class="token punctuation">,</span><span class="token string">"Shared Secret"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$Credentials</span><span class="token punctuation">.</span>Add<span class="token punctuation">(</span> <span class="token variable">$cred</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">Get-Credential</span> <span class="token operator">-</span>Message <span class="token variable">$cred</span> <span class="token operator">-</span>Title <span class="token string">"VoPay Credentials"</span> <span class="token operator">-</span>UserName <span class="token variable">$AccountId</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token variable">$FormattedDate</span> = <span class="token function">Get-Date</span> <span class="token operator">-</span>Format <span class="token string">"yyyy-MM-dd"</span>
<span class="token comment"># $PreSig = $KEY + $SECRET + $FormattedDate</span>
<span class="token variable">$PreSig</span> = <span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span><span class="token string">'Shared Secret'</span><span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token variable">$FormattedDate</span>
<span class="token comment">&lt;# Now perform a SHA1 cryptographic hash #&gt;</span>
<span class="token comment"># First convert the concatenated string into a binary representation.</span>
<span class="token variable">$PreSigChars</span> = <span class="token variable">$PreSig</span><span class="token punctuation">.</span>ToCharArray<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">$PreSigBytes</span> = <span class="token variable">$PreSigChars</span> <span class="token punctuation">|</span> <span class="token function">ForEach-Object</span> <span class="token punctuation">{</span> <span class="token namespace">[System.Convert]</span>::ToByte<span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token variable">$PreSigStream</span> = <span class="token namespace">[IO.MemoryStream]</span>::new<span class="token punctuation">(</span><span class="token variable">$PreSigBytes</span><span class="token punctuation">)</span>
<span class="token comment"># Then, you pass that to a hashing function.</span>
<span class="token variable">$Hash</span> = <span class="token function">Get-FileHash</span> <span class="token operator">-</span>InputStream <span class="token variable">$PreSigStream</span> <span class="token operator">-</span>Algorithm SHA1
<span class="token variable">$Signature</span> = <span class="token variable">$Hash</span><span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>ToLowerInvariant<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-shell"><code class="language-shell"><span class="token comment"># readonly KEY="3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token comment"># readonly SECRET="OTEyZWM4MDNiMmNINDk="</span>
<span class="token builtin class-name">readonly</span> <span class="token assign-left variable">ACCOUNT_ID</span><span class="token operator">=</span><span class="token string">"alice.smith"</span>
<span class="token comment"># Securely read the credentials from the user</span>
<span class="token builtin class-name">readonly</span> <span class="token assign-left variable">KEY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>pass <span class="token string">"<span class="token variable">$ACCOUNT_ID</span>:key"</span><span class="token variable">)</span></span>
<span class="token builtin class-name">readonly</span> <span class="token assign-left variable">SECRET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>pass <span class="token string">"<span class="token variable">$ACCOUNT_ID</span>:secret"</span><span class="token variable">)</span></span>
<span class="token comment"># Format the date</span>
<span class="token assign-left variable">formatted_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y-%m-%d<span class="token variable">)</span></span>
<span class="token assign-left variable">signature</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n $KEY$SECRET$formatted_date <span class="token operator">|</span> sha1sum <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">)</span></span>
</code></pre>
<pre class="language-python"><code class="language-python"><span class="token comment"># KEY = "3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token comment"># SECRET = "OTEyZWM4MDNiMmNINDk="</span>
ACCOUNT_ID <span class="token operator">=</span> <span class="token string">"alice.smith"</span>
<span class="token comment"># Securely read the credentials from the user</span>
KEY <span class="token operator">=</span> getpass<span class="token punctuation">(</span><span class="token string">"Enter your VoPay API key: "</span><span class="token punctuation">)</span>
SECRET <span class="token operator">=</span> getpass<span class="token punctuation">(</span><span class="token string">"Enter your VoPay shared secret: "</span><span class="token punctuation">)</span>
formatted_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span>
pre_sig <span class="token operator">=</span> KEY <span class="token operator">+</span> SECRET <span class="token operator">+</span> formatted_date
signature <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span>pre_sig<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># import hashlib</span>
</code></pre>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">KEY</span> <span class="token operator">=</span> <span class="token string">"3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token keyword">const</span> <span class="token constant">SECRET</span> <span class="token operator">=</span> <span class="token string">"OTEyZWM4MDNiMmNINDk="</span>
<span class="token keyword">const</span> <span class="token constant">ACCOUNT_ID</span> <span class="token operator">=</span> <span class="token string">"alice.smith"</span>
<span class="token keyword">var</span> formattedDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> preSig <span class="token operator">=</span> <span class="token constant">KEY</span> <span class="token operator">+</span> <span class="token constant">SECRET</span> <span class="token operator">+</span> formattedDate
<span class="token keyword">var</span> signature <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>preSig<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-ruby"><code class="language-ruby"><span class="token constant">KEY</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"3da541559918a808c2402bba5012f6c60b27661c"</span></span>
<span class="token constant">SECRET</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"OTEyZWM4MDNiMmNINDk="</span></span>
<span class="token constant">ACCOUNT_ID</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"alice.smith"</span></span>
formatted_date <span class="token operator">=</span> Date<span class="token punctuation">.</span>today<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"%Y-%m-%d"</span></span><span class="token punctuation">)</span>
pre_sig <span class="token operator">=</span> <span class="token constant">KEY</span> <span class="token operator">+</span> <span class="token constant">SECRET</span> <span class="token operator">+</span> formatted_date
signature <span class="token operator">=</span> Digest<span class="token double-colon punctuation">::</span><span class="token constant">SHA1</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span>pre_sig<span class="token punctuation">)</span>
</code></pre>
<pre class="language-php"><code class="language-php"><span class="token variable">$KEY</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token variable">$SECRET</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"OTEyZWM4MDNiMmNINDk="</span>
<span class="token variable">$ACCOUNT_ID</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"alice.smith"</span>
<span class="token variable">$formattedDate</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Y-m-d"</span><span class="token punctuation">)</span>
<span class="token variable">$preSig</span> <span class="token operator">=</span> <span class="token variable">$KEY</span> <span class="token operator">+</span> <span class="token variable">$SECRET</span> <span class="token operator">+</span> <span class="token variable">$formattedDate</span>
signature <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sha1'</span><span class="token punctuation">,</span> preSig<span class="token punctuation">)</span>
</code></pre>
<pre class="language-csharp"><code class="language-csharp"><span class="token comment">// Using statements, class setup, main function omitted for brevity</span>
<span class="token keyword">const</span> KEY <span class="token operator">=</span> <span class="token string">"3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token keyword">const</span> SECRET <span class="token operator">=</span> <span class="token string">"OTEyZWM4MDNiMmNINDk="</span>
<span class="token keyword">const</span> ACCOUNT_ID <span class="token operator">=</span> <span class="token string">"alice.smith"</span>
<span class="token comment">// See note on secure strings: https://github.com/dotnet/platform-compat/blob/master/docs/DE0001.md</span>
<span class="token class-name"><span class="token keyword">var</span></span> formatted_date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token keyword">var</span></span> preSig <span class="token operator">=</span> KEY <span class="token operator">+</span> SECRET <span class="token operator">+</span> formatted_date
<span class="token class-name"><span class="token keyword">var</span></span> signature <span class="token operator">=</span> SHA1<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>preSig<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToHexString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-java"><code class="language-java"><span class="token comment">// Import statements, class setup, main function omitted for brevity</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY <span class="token operator">=</span> <span class="token string">"3da541559918a808c2402bba5012f6c60b27661c"</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SECRET <span class="token operator">=</span> <span class="token string">"OTEyZWM4MDNiMmNINDk="</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> formattedDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// import java.text.SimpleDateFormat</span>
<span class="token class-name">String</span> preSig <span class="token operator">=</span> KEY <span class="token operator">+</span> SECRET <span class="token operator">+</span> formattedDate<span class="token punctuation">;</span>
<span class="token class-name">String</span> signature <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA-1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>preSig<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// import java.security.MessageDigest;</span>
</code></pre>
<pre class="language-go"><code class="language-go"><span class="token comment">// Import statements and main function omitted for brevity</span>
<span class="token keyword">const</span> KEY <span class="token operator">=</span> <span class="token string">"3da541559918a808c2402bba5012f6c60b27661c"</span>
<span class="token keyword">const</span> SECRET <span class="token operator">=</span> <span class="token string">"OTEyZWM4MDNiMmNINDk="</span>
<span class="token keyword">var</span> formatted_date <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02"</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> pre_sig <span class="token operator">=</span> KEY <span class="token operator">+</span> SECRET <span class="token operator">+</span> formatted_date
<span class="token keyword">var</span> signature <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> sha1<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>pre_sig<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// import "crypto/sha1"</span>
</code></pre>
<p><a href="#Checking-your-VoPay-balance" class="decoratenone">Later</a>, you will use the signature to receive sandbox data from VoPay.</p>
<h2 id="Response-Readiness" tabindex="-1">Response Readiness</h2>
<p>Your application needs to be able to send well-formed calls and process successful, flagged, and failed responses.</p>
<ul>
<li><em>Successful</em> only means the transaction was sent to the bank for processing (<a href="#polling-for-transaction-statuses">poll</a> or <a href="#setup-webhook-notifications">webhook</a> to know if it clears).</li>
<li><em>Flagged</em> means the transaction is temporarily held for your review (see <a href="#flagged-transactions">clearing flags</a>).</li>
<li><em>Failed</em> means the transaction reached an unrecoverable conclusion (see <a href="#failure">failure reasons</a>).</li>
</ul>
<h3 id="Input-validation" tabindex="-1">Input validation</h3>
<p>VoPay performs format checks to ensure the data you provided is valid and can be processed. Calls that are not well-formed will return an error.</p>
<h3 id="Example-valid-input" tabindex="-1">Example valid input</h3>
<p>The Postman collection provides examples of valid input for each field.</p>
<h3 id="API-Responses" tabindex="-1">API Responses</h3>
<p>Correspondingly, your solution should anticipate and process responses to <strong>both successful and unsuccessful</strong> API calls and transaction requests.</p>
<p><img src="https://raw.githubusercontent.com/gist/mavaddat/c238fcebca80e66a327cb47be271e4ae/raw/ce2434292580a514b39300f1d3ebd2b1cc966b71/response.svg" alt="Response diagram"></p>
<p>Successful calls to the API <em>may not necessarily</em> produce successful transactions (see <a href="#when-do-transactions-fail">When do transactions fail?</a>). Successful calls can be identified by <code>"true"</code> in the <code>Success</code> field (and <code>""</code> in <code>ErrorMessage</code>); conversely, a <code>Success</code> response of <code>"false"</code>indicates that <a href="#common-errors">there will be important information</a> in the <code>ErrorMessage</code>. Unsuccessful transactions will show <code>"failed"</code> in the <code>TransactionStatus</code> field.</p>
<p>See the <a href="https://docs.vopay.com/v2/vopay-api-reference/ref">API specification</a> for a complete enumeration of responses for each call.</p>
<h2 id="Idempotent-requests" tabindex="-1">Idempotent requests</h2>
<p>To ensure you can safely retry requests without accidentally performing the same operation twice, all of our transaction endpoints support <em>idempotency</em>. API idempotency is useful in case your requests are disrupted in transit or you otherwise fail to receive a response.</p>
<aside class="notice">When idempotency is enabled, multiple invocations will not duplicate the transaction.</aside>
<p>For example, if a request to the <a href="https://docs.vopay.com/v2/vopay-api-reference/ref#eftfundget"><strong>EFT Fund endpoint</strong></a> does not respond due to a network connection error, you can retry the <code>FUND</code> request with the same <strong>idempotency key</strong>, thereby guaranteeing that not more than one funding transaction will have been created.</p>
<p><div class="autocaption"><figure><img src="../slate/img/idempotency.png" alt="Idempotency flow chart" class="autocaption"><figcaption>You choose a unique idempotency key that you assign to each call. If we have seen the key already, we notify you and ask for a new key. Otherwise, the API call is executed.</figcaption></figure></div></p>
<p>An idempotency key is a unique key of your choosing which the server can use to recognize and reject subsequent retries of the same request. To perform an idempotent request, provide an <code>IdempotencyKey</code> in the body of the <code>POST</code> request.</p>
<aside class="notice">The specific implementation of generating the unique value is up to you. It can be as simple as just an ordinal number (1, 2, 3, …) or as complex as a hash of critical details.</aside>
<h1 id="Checking-your-VoPay-balance" tabindex="-1">Checking your VoPay balance</h1>
<p><code class="httpmethod">GET</code> <code class="endpoint">account/balance</code></p>
<p>Now you will use <a href="#Generating-your-signature">your signature</a> to receive information from the sandbox. Routinely checking your balance before submitting any transaction is best practice, which this guide henceforth follows.</p>
<p>To do this, you need only your account ID, API key, and signature.</p>
<blockquote>
<p>Query Parameters</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Data Type</th>
<th>Description</th>
<th>Necessity</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AccountID</code></td>
<td><code>string</code></td>
<td>Your account ID</td>
<td>required</td>
</tr>
<tr>
<td><code>Key</code></td>
<td><code>string</code></td>
<td>API key for the account</td>
<td>required</td>
</tr>
<tr>
<td><code>Signature</code></td>
<td><code>string</code></td>
<td>Hashed signature for the request</td>
<td>required</td>
</tr>
<tr>
<td><code>Currency</code></td>
<td><code>string</code></td>
<td>ISO 4217 3-character code for currency of transactions to fetch. Defaults to the wallet’s local currency (<code>CAD</code>)</td>
<td>optional</td>
</tr>
</tbody>
</table>
<pre class="language-powershell"><code class="language-powershell"><span class="token function">Invoke-RestMethod</span> <span class="token operator">-</span>Method Get <span class="token operator">-</span>Uri <span class="token string">"https://earthnode-dev.vopay.com/api/v2/account/balance?AccountID=<span class="token variable">$AccountID</span>&amp;Key=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span></span>&amp;Signature=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Signature</span><span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>ToLowerInvariant<span class="token punctuation">(</span><span class="token punctuation">)</span></span>)&amp;Currency=CAD"</span>
</code></pre>
<pre class="language-shell"><code class="language-shell"><span class="token assign-left variable">account_id</span><span class="token operator">=</span><span class="token string">"alice.smith"</span>
<span class="token function">curl</span> -s -X GET <span class="token string">"https://earthnode-dev.vopay.com/api/v2/account/balance?AccountID=<span class="token variable">$account_id</span>&amp;Key=<span class="token variable">$KEY</span>&amp;Signature=<span class="token variable">$signature</span>&amp;Currency=CAD"</span>
</code></pre>
<pre class="language-python"><code class="language-python">account_id<span class="token operator">=</span><span class="token string">"alice.smith"</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://earthnode-dev.vopay.com/api/v2/account/balance?AccountID=%s&amp;Key=%s&amp;Signature=%s&amp;Currency=CAD"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>account_id<span class="token punctuation">,</span> KEY<span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>The result</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"AccountBalance"</span><span class="token operator">:</span> <span class="token string">"3000.00"</span><span class="token punctuation">,</span>
  <span class="token property">"PendingFunds"</span><span class="token operator">:</span> <span class="token string">"700.00"</span><span class="token punctuation">,</span>
  <span class="token property">"SecurityDeposit"</span><span class="token operator">:</span> <span class="token string">"1000.00"</span><span class="token punctuation">,</span>
  <span class="token property">"AvailableFunds"</span><span class="token operator">:</span> <span class="token string">"1300.00"</span><span class="token punctuation">,</span>
  <span class="token property">"Currency"</span><span class="token operator">:</span> <span class="token string">"CAD"</span>
<span class="token punctuation">}</span>
</code></pre>
<aside class="caution">To send out funds, you must not exceed the available funds. To make a $2,000 transaction in CAD, for example, you must have ≥$2,000 of Canadian currency in your wallet.</aside>
<h2 id="The-response-explained" tabindex="-1">The response explained</h2>
<p>A closer look at the response from the API:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Success</code></td>
<td><code>boolean</code></td>
<td><code>true</code> when request successful, <code>false</code> when failed</td>
</tr>
<tr>
<td><code>ErrorMessage</code></td>
<td><code>string</code></td>
<td>Contains a description of the error if the request failed</td>
</tr>
<tr>
<td><code>AccountBalance</code></td>
<td><code>number</code></td>
<td>Indicates the total current account balance, including pending funds.</td>
</tr>
<tr>
<td><code>PendingFunds</code></td>
<td><code>number</code></td>
<td>Indicates the portion of the account balance which is pending due to <em>in-progress</em> EFT transactions.</td>
</tr>
<tr>
<td><code>SecurityDeposit</code></td>
<td><code>number</code></td>
<td>Indicates the portion of the account balance which is being held as a security deposit against returned or fraudulent transactions.</td>
</tr>
<tr>
<td><code>AvailableFunds</code></td>
<td><code>number</code></td>
<td>Indicates the portion of the account balance which is currently available for use. This is calculated <code>AccountBalance</code>&nbsp;-&nbsp;(<code>PendingFunds</code>&nbsp;+&nbsp;<code>SecurityDeposit</code>).</td>
</tr>
<tr>
<td><code>Currency</code></td>
<td><code>string</code></td>
<td>3 character currency code for the balance being returned.</td>
</tr>
</tbody>
</table>
<aside class="success">You queried the VoPay <a href="https://docs.vopay.com/v2/vopay-api-reference/ref#accountbalanceget" target="_blank"><code>GET</code> account/balance endpoint</a> to retrieve the current account balance for your sandbox account.</aside>
<p>The first step to getting a positive balance is to <em>fund your wallet</em>.</p>
<h1 id="Funding-your-VoPay-wallet" tabindex="-1">Funding your VoPay wallet</h1>
<p>There are two primary methods to move funds into your VoPay wallet.</p>
<h2 id="Electronic-Funds-Transfer-EFT-Fund" tabindex="-1">Electronic Funds Transfer (EFT) Fund</h2>
<p><code class="httpmethod">POST</code> <code class="endpoint">/eft/fund</code></p>
<p>To fund your VoPay account by EFT, you will <strong>deposit</strong> funds into your wallet — like depositing a cheque. Minimally, this requires providing the <em>deposit amount</em>, <em>payee name</em>, <em>payee’s address</em>, and <em>payee’s bank info</em>: institution, transit, account number (<strong>ITA</strong>).</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Amount</code></td>
<td><code>number</code></td>
<td>The amount to debit from the customer’s bank account.</td>
</tr>
<tr>
<td><code>FirstName</code></td>
<td><code>string</code></td>
<td>The first name of the payee.</td>
</tr>
<tr>
<td><code>LastName</code></td>
<td><code>string</code></td>
<td>The last name of the payee.</td>
</tr>
<tr>
<td><code>Address1</code></td>
<td><code>string</code></td>
<td>The street address of the payee.</td>
</tr>
<tr>
<td><code>City</code></td>
<td><code>string</code></td>
<td>The city of the payee.</td>
</tr>
<tr>
<td><code>Province</code></td>
<td><code>string</code></td>
<td>Two-character abbreviated province of the payee (e.g., ON, BC, AB).</td>
</tr>
<tr>
<td><code>PostalCode</code></td>
<td><code>string</code></td>
<td>The postal code of the payee.</td>
</tr>
<tr>
<td><code>Country</code></td>
<td><code>string</code></td>
<td>Full or ISO 3166-1 two-character abbreviated country of the payee (e.g., CA, US).</td>
</tr>
<tr>
<td><code>FinancialInstitutionNumber</code></td>
<td><code>integer</code></td>
<td>The institution number of the payee’s bank.</td>
</tr>
<tr>
<td><code>BranchTransitNumber</code></td>
<td><code>integer</code></td>
<td>The transit number of the payee’s bank.</td>
</tr>
<tr>
<td><code>AccountNumber</code></td>
<td><code>integer</code></td>
<td>The payee’s bank account number.</td>
</tr>
</tbody>
</table>
<p>For example, to deposit $200 into your VoPay wallet, you would <code>POST</code> to <code>/eft/fund</code> with the following parameters:</p>
<blockquote>
<p>Query Parameters</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Amount"</span><span class="token operator">:</span> <span class="token number">200.00</span><span class="token punctuation">,</span>
  <span class="token property">"LastName"</span><span class="token operator">:</span> <span class="token string">"Smith"</span><span class="token punctuation">,</span>
  <span class="token property">"FirstName"</span><span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span>
  <span class="token property">"FinancialInstitutionNumber"</span><span class="token operator">:</span> <span class="token string">"000"</span><span class="token punctuation">,</span>
  <span class="token property">"BranchTransitNumber"</span><span class="token operator">:</span> <span class="token number">12345</span><span class="token punctuation">,</span>
  <span class="token property">"AccountNumber"</span><span class="token operator">:</span> <span class="token number">123456</span><span class="token punctuation">,</span>
  <span class="token property">"Address1"</span><span class="token operator">:</span> <span class="token string">"123 Main St."</span><span class="token punctuation">,</span>
  <span class="token property">"City"</span><span class="token operator">:</span> <span class="token string">"Vancouver"</span><span class="token punctuation">,</span>
  <span class="token property">"Province"</span><span class="token operator">:</span> <span class="token string">"BC"</span><span class="token punctuation">,</span>
  <span class="token property">"PostalCode"</span><span class="token operator">:</span> <span class="token string">"V1A 1A1"</span><span class="token punctuation">,</span>
  <span class="token property">"Country"</span><span class="token operator">:</span> <span class="token string">"CA"</span>
<span class="token punctuation">}</span>
</code></pre>
<aside class="test">
See if you are able to post an EFT transaction to the sandbox using the code sample in your preferred language.
</aside>
<blockquote>
<p>Post $2,000 to your VoPay wallet using EFT</p>
</blockquote>
<p>&lt;!-- CODE SNIPPET HERE --&gt;</p>
<blockquote>
<p>The following is a typical response:</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"436749"</span><span class="token punctuation">,</span>
  <span class="token property">"Iq11"</span><span class="token operator">:</span> <span class="token string">"0"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In your solution, be sure to record the <code>TransactionID</code> you receive. You will need it to make future API calls on the transaction (e.g., getting status, cancelling, unflagging, etc.).</p>
<blockquote>
<p>Check your balance to verify the transaction.</p>
</blockquote>
<pre class="language-powershell"><code class="language-powershell"><span class="token function">Invoke-RestMethod</span> <span class="token operator">-</span>Method Get <span class="token operator">-</span>Uri <span class="token string">"https://earthnode-dev.vopay.com/api/v2/account/balance?AccountID=<span class="token variable">$AccountID</span>&amp;Key=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span></span>&amp;Signature=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Signature</span><span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>ToLowerInvariant<span class="token punctuation">(</span><span class="token punctuation">)</span></span>)&amp;Currency=CAD"</span>
</code></pre>
<p>The change:</p>
<table>
<thead>
<tr>
<th>Before</th>
<th>After</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="slate/img/before_eft.svg" alt="Account balance before EFT"></td>
<td><img src="slate/img/after_eft.svg" alt="Account balance after EFT"></td>
</tr>
</tbody>
</table>
<p>The account balance has increased by $200.00. The same amount can be seen in the pending balance. This will be the case until the transaction <strong>settles</strong>.</p>
<aside class="notice">
The EFT adds to <em>pending</em> and <em>account</em> balances, but the funds are not available until the transaction settles (typically, 3 business days).
</aside>
<p><img src="slate/img/settlement.svg" alt=""></p>
<p>Funding transactions settle at midnight after 3 business days. A transaction submitted on Monday at 2 PM, for example, will settle at 11:59 PM EST on Thursday.</p>
<h2 id="Interac-money-request" tabindex="-1">Interac money request</h2>
<p><code class="httpmethod">POST</code> <code class="endpoint">/interac/money-request</code></p>
<p>To fund by Interac money request, you need only a recipient name, email address, and amount.</p>
<p>For example, to request $300.00 from <code>John Doe</code>:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"RecipientName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>
  <span class="token property">"Email"</span><span class="token operator">:</span> <span class="token string">"john.doe@hotmail.com"</span><span class="token punctuation">,</span>
  <span class="token property">"Amount"</span><span class="token operator">:</span> <span class="token number">3000.00</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-powershell"><code class="language-powershell"><span class="token variable">$Endpoint</span> = <span class="token string">"interac/money-request"</span>
<span class="token variable">$InteracMoneyRequest</span> = @<span class="token punctuation">{</span>
        Amount=3000<span class="token punctuation">.</span>00<span class="token punctuation">;</span>
        Email=<span class="token string">"john.doe@hotmail.com"</span><span class="token punctuation">;</span>
        RecipientName=<span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span>
<span class="token function">Invoke-RestMethod</span> <span class="token operator">-</span>Method Post <span class="token operator">-</span>Uri <span class="token string">"https://earthnode-dev.vopay.com/api/v2/<span class="token variable">$Endpoint</span>?AccountID=<span class="token variable">$AccountID</span>&amp;Key=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span></span>&amp;Signature=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Signature</span><span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>ToLowerInvariant<span class="token punctuation">(</span><span class="token punctuation">)</span></span>)&amp;Currency=CAD"</span> <span class="token operator">-</span>Body <span class="token variable">$InteracMoneyRequest</span> <span class="token punctuation">|</span> <span class="token function">ConvertTo-Json</span>
</code></pre>
<pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">declare</span> -A <span class="token assign-left variable">InteracMoneyRequest</span><span class="token operator">=</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>Amount<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3000.00</span>
    <span class="token punctuation">[</span>Email<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"john.doe@gmail.com"</span>
    <span class="token punctuation">[</span>RecipientName<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"John Doe"</span>
<span class="token punctuation">)</span>
<span class="token function">curl</span> -X POST -H <span class="token string">"Content-Type: application/json"</span> -d <span class="token string">"<span class="token variable"><span class="token variable">$(</span>jq -n <span class="token string">"<span class="token variable">$InteracMoneyRequest</span>"</span><span class="token variable">)</span></span>"</span> <span class="token string">"https://earthnode-dev.vopay.com/api/v2/interac/money-request?AccountID=<span class="token variable">$account_id</span>&amp;Key=<span class="token variable">$KEY</span>&amp;Signature=<span class="token variable">$signature</span>&amp;Currency=CAD"</span>
</code></pre>
<pre class="language-ruby"><code class="language-ruby">InteracMoneyRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token symbol">Amount</span><span class="token operator">:</span> <span class="token number">3000.00</span><span class="token punctuation">,</span>
    <span class="token symbol">Email</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"john.doe@gmail.com"</span></span>
    <span class="token symbol">RecipientName</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"John Doe"</span></span>
<span class="token punctuation">}</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"https://earthnode-dev.vopay.com/api/v2/interac/money-request?AccountID=%s&amp;Key=%s&amp;Signature=%s&amp;Currency=CAD"</span></span> <span class="token operator">%</span> <span class="token punctuation">[</span>account_id<span class="token punctuation">,</span> <span class="token constant">KEY</span><span class="token punctuation">,</span> signature<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token symbol">json</span><span class="token operator">:</span> InteracMoneyRequest<span class="token punctuation">)</span>
</code></pre>
<pre class="language-python"><code class="language-python">InteracMoneyRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"Amount"</span><span class="token punctuation">:</span> <span class="token number">3000.00</span><span class="token punctuation">,</span>
    <span class="token string">"Email"</span><span class="token punctuation">:</span> <span class="token string">"john.doe@gmail.com"</span><span class="token punctuation">,</span>
    <span class="token string">"RecipientName"</span><span class="token punctuation">:</span> <span class="token string">"John Doe"</span>
<span class="token punctuation">}</span>
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"https://earthnode-dev.vopay.com/api/v2/interac/money-request?AccountID=%s&amp;Key=%s&amp;Signature=%s&amp;Currency=CAD"</span> <span class="token operator">%</span> <span class="token punctuation">[</span>account_id<span class="token punctuation">,</span> KEY<span class="token punctuation">,</span> signature<span class="token punctuation">]</span><span class="token punctuation">,</span> json<span class="token punctuation">:</span> InteracMoneyRequest<span class="token punctuation">)</span>
</code></pre>
<pre class="language-php"><code class="language-php"><span class="token variable">$InteracMoneyRequest</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">"Amount"</span> <span class="token operator">=&gt;</span> <span class="token number">3000.00</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">"Email"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"john.doe@gmail.com"</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">"RecipientName"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"John Doe"</span>
<span class="token punctuation">)</span>
r <span class="token operator">=</span> requests<span class="token operator">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"https://earthnode-dev.vopay.com/api/v2/interac/money-request?AccountID=%s&amp;Key=%s&amp;Signature=%s&amp;Currency=CAD"</span> <span class="token operator">%</span> <span class="token punctuation">[</span>account_id<span class="token punctuation">,</span> <span class="token constant">KEY</span><span class="token punctuation">,</span> signature<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token argument-name">json</span><span class="token punctuation">:</span> <span class="token variable">$InteracMoneyRequest</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> InteracMoneyRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token string">"Amount"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3000.00</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"Email"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"john.doe@gmail.com"</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">"RecipientName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"John Doe"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
r <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">PostAsync</span><span class="token punctuation">(</span><span class="token string">"https://earthnode-dev.vopay.com/api/v2/interac/money-request?AccountID=%s&amp;Key=%s&amp;Signature=%s&amp;Currency=CAD"</span> <span class="token operator">%</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">account_id</span><span class="token punctuation">,</span> <span class="token class-name">KEY</span><span class="token punctuation">,</span> <span class="token class-name">signature</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringContent</span><span class="token punctuation">(</span>JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>InteracMoneyRequest<span class="token punctuation">)</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-javascript"><code class="language-javascript">
</code></pre>
<pre class="language-java"><code class="language-java">
</code></pre>
<pre class="language-go"><code class="language-go">
</code></pre>
<!--show how it impacts balance -->
<p>The result:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"437073"</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionStatus"</span><span class="token operator">:</span> <span class="token string">"requested"</span><span class="token punctuation">,</span>
  <span class="token property">"Flagged"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here, you see the account balance and pending funds increased by the amount you requested ($300 in the example):</p>
<table>
<thead>
<tr>
<th>Before</th>
<th>After</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="slate/img/before_imr.svg" alt=""></td>
<td><img src="slate/img/after_imr.svg" alt=""></td>
</tr>
</tbody>
</table>
<p>Interac transactions are processed nearly in real-time, meaning the request email is sent out to recipients right away.</p>
<p>Once the request is accepted by the recipient, the funds are made available in your account.</p>
<h1 id="Sending-money-from-your-VoPay-wallet" tabindex="-1">Sending money from your VoPay wallet</h1>
<p>There are two primary methods to send money from your VoPay wallet. Later, this guide introduces more advanced means of sending funds.</p>
<h2 id="EFT-Withdraw" tabindex="-1">EFT Withdraw</h2>
<p><code class="httpmethod">POST</code> <code class="endpoint">/eft/withdraw</code></p>
<!-- need name, address, amount, ITA info -->
<p>Sending money by EFT is like writing someone a cheque. As with <code>eft/fund</code>, to send by electronic funds transfer, you will need a recipient’s name, recipient’s address, amount, and the recipient’s ITA information.</p>
<pre class="language-powershell"><code class="language-powershell"><span class="token variable">$Endpoint</span>=<span class="token string">"eft/withdraw"</span>
<span class="token variable">$Body</span> = @<span class="token punctuation">{</span>
    Amount=5000<span class="token punctuation">.</span>00<span class="token punctuation">;</span>
    FirstName=<span class="token string">"Adam"</span><span class="token punctuation">;</span>
    LastName=<span class="token string">"Smith"</span><span class="token punctuation">;</span>
    AccountNumber=123456<span class="token punctuation">;</span>
    FinancialInstitutionNumber=<span class="token string">"000"</span><span class="token punctuation">;</span>
    BranchTransitNumber=12345<span class="token punctuation">;</span>
    Address1=<span class="token string">"123 Main St."</span><span class="token punctuation">;</span>
    City=<span class="token string">"Vancouver"</span><span class="token punctuation">;</span>
    Province=<span class="token string">"BC"</span><span class="token punctuation">;</span>
    Country=<span class="token string">"CA"</span><span class="token punctuation">;</span>
    PostalCode=<span class="token string">"V1A 1A1"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">Invoke-RestMethod</span> <span class="token operator">-</span>Method Post <span class="token operator">-</span>Uri <span class="token string">"https://earthnode-dev.vopay.com/api/v2/${Endpoint}?AccountID=<span class="token variable">$AccountID</span>&amp;Key=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span></span>&amp;Signature=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Signature</span><span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>ToLowerInvariant<span class="token punctuation">(</span><span class="token punctuation">)</span></span>)&amp;Currency=CAD"</span> <span class="token operator">-</span>Body <span class="token variable">$Body</span>
</code></pre>
<pre class="language-shell"><code class="language-shell"> 
</code></pre>
<pre class="language-ruby"><code class="language-ruby"> 
</code></pre>
<pre class="language-python"><code class="language-python"> 
</code></pre>
<pre class="language-php"><code class="language-php"> 
</code></pre>
<pre class="language-csharp"><code class="language-csharp"> 
</code></pre>
<pre class="language-javascript"><code class="language-javascript"> 
</code></pre>
<pre class="language-java"><code class="language-java"> 
</code></pre>
<pre class="language-go"><code class="language-go"> 
</code></pre>
<p>A typical response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> True<span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token punctuation">,</span>
  <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token number">437087</span><span class="token punctuation">,</span>
  <span class="token property">"Iq11"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<!-- show how it impacts balance (money is withdrawn immediately) -->
<p>If you check the balance now, you will see<code>AccountBalance</code> and <code>AvailableFunds</code> decrease by the amount withdrawn.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"AccountBalance"</span><span class="token operator">:</span> PreviousAccountBalance - WithdrawnAmount<span class="token punctuation">,</span>
  <span class="token property">"PendingFunds"</span><span class="token operator">:</span> <span class="token string">"0.00"</span><span class="token punctuation">,</span>
  <span class="token property">"SecurityDeposit"</span><span class="token operator">:</span> <span class="token string">"5000.00"</span><span class="token punctuation">,</span>
  <span class="token property">"AvailableFunds"</span><span class="token operator">:</span> PreviousAccountBalance - WithdrawnAmount<span class="token punctuation">,</span>
  <span class="token property">"Currency"</span><span class="token operator">:</span> <span class="token string">"CAD"</span>
<span class="token punctuation">}</span>
</code></pre>
<!-- transaction is marked as successful at midnight EST on the day the withdraw was submitted (i.e., if withdraw was done at 2pm on Monday, transaction will be marked as successful at 11:59pm EST on Monday) -->
<p>The withdrawal will be marked as successful at midnight EST on the day the withdrawal was submitted. For example, a withdrawal performed at 2 PM on Monday will be marked as successful at 11:59 PM EST on Monday.</p>
<p><img src="slate/img/withdrawal.svg" alt="Diagram showing settlement period for withdrawal"></p>
<h2 id="Interac-e-transfer" tabindex="-1">Interac e-transfer</h2>
<!-- /interac/bulk-payout -->
<p><code class="httpmethod">POST</code> <code class="endpoint">/interac/bulk-payout</code></p>
<!-- need recipient name, email address, amount, security question/answer -->
<p>Sending an Interac e-transfer is the familiar process of sending money to another person by email or SMS. To send by Interac, you will need a recipient’s name (or cellphone number), recipient’s email address, amount to send, and the security question/answer you want the recipient to answer.</p>
<!-- show example -->
<pre class="language-powershell"><code class="language-powershell"><span class="token variable">$Endpoint</span> = <span class="token string">"interac/bulk-payout"</span>
<span class="token variable">$Body</span> = @<span class="token punctuation">{</span>
    Amount=1000<span class="token punctuation">.</span>00<span class="token punctuation">;</span>
    RecipientName=<span class="token string">"Samuel Adams"</span><span class="token punctuation">;</span>
    Question=<span class="token string">"Why?"</span><span class="token punctuation">;</span>
    Answer=<span class="token string">"Why not"</span><span class="token punctuation">;</span>
    EmailAddress=<span class="token string">"samuel.adams@yahoo.ca"</span>
<span class="token punctuation">}</span>
<span class="token function">Invoke-RestMethod</span> <span class="token operator">-</span>Method Post <span class="token operator">-</span>Uri <span class="token string">"https://earthnode-dev.vopay.com/api/v2/${Endpoint}?AccountID=<span class="token variable">$AccountID</span>&amp;Key=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Credentials</span><span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Password <span class="token punctuation">|</span> <span class="token function">ConvertFrom-SecureString</span> <span class="token operator">-</span>AsPlainText<span class="token punctuation">)</span></span>&amp;Signature=<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$Signature</span><span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>ToLowerInvariant<span class="token punctuation">(</span><span class="token punctuation">)</span></span>)&amp;Currency=CAD"</span> <span class="token operator">-</span>Body <span class="token variable">$Body</span>
</code></pre>
<pre class="language-shell"><code class="language-shell">
</code></pre>
<pre class="language-ruby"><code class="language-ruby">
</code></pre>
<pre class="language-python"><code class="language-python">
</code></pre>
<pre class="language-php"><code class="language-php">
</code></pre>
<pre class="language-csharp"><code class="language-csharp">
</code></pre>
<pre class="language-javascript"><code class="language-javascript">
</code></pre>
<pre class="language-java"><code class="language-java">
</code></pre>
<pre class="language-go"><code class="language-go">
</code></pre>
<p>A successful Interac e-transfer will return the following response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"437093"</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionConfirmed"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
<!-- show how it impacts balance -->
<p>As in <a href="#EFT-Withdraw">EFT withdraw</a>, <code>AccountBalance</code> and <code>AvailableFunds</code> decrease by the amount sent if the balance is queried.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"AccountBalance"</span><span class="token operator">:</span> PreviousAccountBalance - Amount<span class="token punctuation">,</span>
  <span class="token property">"PendingFunds"</span><span class="token operator">:</span> <span class="token string">"0.00"</span><span class="token punctuation">,</span>
  <span class="token property">"SecurityDeposit"</span><span class="token operator">:</span> <span class="token string">"5000.00"</span><span class="token punctuation">,</span>
  <span class="token property">"AvailableFunds"</span><span class="token operator">:</span> PreviousAvailableFunds - Amount<span class="token punctuation">,</span>
  <span class="token property">"Currency"</span><span class="token operator">:</span> <span class="token string">"CAD"</span>
<span class="token punctuation">}</span>
</code></pre>
<!-- transactions are executed in near real-time -->
<p>Interac e-transfer transactions are executed in real-time, practically.</p>
<!-- transaction is marked as complete once the recipient accepts e-transfer -->
<p>A transaction will be marked as <code>successful</code> once the recipient accepts the e-transfer.</p>
<h1 id="The-Transaction-lifecycle" tabindex="-1">The Transaction lifecycle</h1>
<p>From submission to settlement, each transaction is processed in a sequence of steps. The current state of any transaction is captured by the <code>TransactionStatus</code> attribute. Below you can find the typical status progression per transaction type.</p>
<!-- EFTs -->
<h2 id="EFTs" tabindex="-1">EFTs</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Status</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Pending</td>
<td style="text-align:center">The transaction starts in the <code>Pending</code> state when it is submitted. This is the initial state for every transaction.</td>
</tr>
<tr>
<td style="text-align:center">In Progress</td>
<td style="text-align:center">When the transaction is submitted to the bank, it is moved to the <code>In Progress</code> state.</td>
</tr>
<tr>
<td style="text-align:center">Successful</td>
<td style="text-align:center">When the transaction is settled and the funds have cleared, it is moved to the <code>Successful</code> state.</td>
</tr>
</tbody>
</table>
<!-- Interac Money request -->
<h2 id="Interac-Money-Request" tabindex="-1">Interac Money Request</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Status</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Pending</td>
<td style="text-align:center">When submitted, the transaction starts in the <code>Pending</code> state.</td>
</tr>
<tr>
<td style="text-align:center">Sent</td>
<td style="text-align:center">When the transaction is submitted to the recipient (payee), it is moved to the <code>In Progress</code> state.</td>
</tr>
<tr>
<td style="text-align:center">Successful</td>
<td style="text-align:center">When the recipient accepts the money request, the transaction is moved to the <code>Successful</code> state.</td>
</tr>
</tbody>
</table>
<!-- Interac e-transfer -->
<h2 id="Interac-e-Transfer" tabindex="-1">Interac e-Transfer</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Status</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Pending</td>
<td style="text-align:center">When submitted, the transaction starts in the <code>Pending</code> state.</td>
</tr>
<tr>
<td style="text-align:center">Requested</td>
<td style="text-align:center">When an email has been sent to funds recipient, it is moved to the <code>In Progress</code> state.</td>
</tr>
<tr>
<td style="text-align:center">Successful</td>
<td style="text-align:center">When the recipient accepts the e-transfer, the transaction is moved to the <code>Successful</code> state.</td>
</tr>
</tbody>
</table>
<h2 id="Polling-for-transaction-statuses" tabindex="-1">Polling for transaction statuses</h2>
<p>One technique for tracking changes in transaction status is to <em>poll</em> (intermittently query) the transaction status endpoint.</p>
<p><code>GET</code> <code>/account/transactions</code></p>
<p>Minimally, this query requires the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>StartDateTime</code></td>
<td><code>string</code></td>
<td>Return transactions that occurred on or after this date/time. Can be specified in either YYYY-MM-DD HH:MM:SS or YYYY-MM-DD format.</td>
</tr>
<tr>
<td><code>EndDateTime</code></td>
<td><code>string</code></td>
<td>Return transactions that occurred on or before this date/time. Can be specified in either <code>YYYY-MM-DD HH:MM:SS</code> or <code>YYYY-MM-DD</code> format.</td>
</tr>
</tbody>
</table>
<p>Additional filters may be specified by adding optional query parameters as follows:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Currency</code></td>
<td><code>string</code></td>
<td>3-character ISO 4217 currency code of transactions to return. Defaults to the wallet’s local currency.</td>
</tr>
<tr>
<td><code>TransactionType</code></td>
<td><code>string</code></td>
<td>Specifies the type of transaction(s) to return. Accepted values are: ‘<code>EFT Funding</code>’, ‘<code>EFT Withdrawal</code>’, ‘<code>Interac Money Request</code>’, ‘<code>Interac Bulk Payout</code>’, ‘<code>Credit Card</code>’, ‘<code>Fee</code>’, ‘<code>Reversal</code>’.</td>
</tr>
<tr>
<td><code>TransactionID</code></td>
<td><code>integer</code></td>
<td>Searches for a transaction with the specified ID, including any related child transactions which may exist.</td>
</tr>
<tr>
<td><code>ClientReferenceNumber</code></td>
<td><code>string</code></td>
<td>Returns transactions with the specified client reference number.</td>
</tr>
<tr>
<td><code>ScheduledTransactionID</code></td>
<td><code>string</code></td>
<td>Id of the scheduled transaction to find</td>
</tr>
<tr>
<td><code>IsFlagged</code></td>
<td><code>boolean</code></td>
<td>Only return transactions that have a flag status <em>unconfirmed</em> by the client.</td>
</tr>
<tr>
<td><code>IsRefunded</code></td>
<td><code>boolean</code></td>
<td>Only return transactions that have been refunded.</td>
</tr>
</tbody>
</table>
<h3 id="Workflow" tabindex="-1">Workflow</h3>
<p>A typical polling workflow to track transaction status changes might utilize a cron service to iterate over the list of transaction IDs, making a <code>GET</code> request to <code>/account/transactions</code> for each ID.</p>
<aside class="caution">You may incur additional fees for polling too frequently.</aside>
<h3 id="Response-Schema" tabindex="-1">Response Schema</h3>
<p>The returned <code>Transactions</code> object is a zero-indexed hash-table of transactions with <code>NumberOfRecords</code> total number of records. Here is a sample response (truncated with <code>/*[…]*/</code> for legibility):</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"NumberOfRecords"</span><span class="token operator">:</span> <span class="token number">343</span><span class="token punctuation">,</span>
  <span class="token property">"Transactions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"442121"</span><span class="token punctuation">,</span>
      <span class="token property">"TransactionDateTime"</span><span class="token operator">:</span> <span class="token string">"2022-02-16 06:48:48"</span><span class="token punctuation">,</span>
      <span class="token property">"TransactionType"</span><span class="token operator">:</span> <span class="token string">"EFT Funding"</span><span class="token punctuation">,</span>
      <span class="token property">"TransactionStatus"</span><span class="token operator">:</span> <span class="token string">"pending"</span><span class="token punctuation">,</span>
      <span class="token property">"Notes"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"DebitAmount"</span><span class="token operator">:</span> <span class="token string">"0.00"</span><span class="token punctuation">,</span>
      <span class="token property">"CreditAmount"</span><span class="token operator">:</span> <span class="token string">"10.00"</span><span class="token punctuation">,</span>
      <span class="token property">"Currency"</span><span class="token operator">:</span> <span class="token string">"CAD"</span><span class="token punctuation">,</span>
      <span class="token property">"HoldAmount"</span><span class="token operator">:</span> <span class="token string">"10.00"</span><span class="token punctuation">,</span>
      <span class="token property">"LastModified"</span><span class="token operator">:</span> <span class="token string">"2022-02-16 06:48:48"</span><span class="token punctuation">,</span>
      <span class="token property">"ParentTransactionID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"ChildTransactionIDs"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"ClientReferenceNumber"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"ScheduledTransactionID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"ClientAccountID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"TransactionErrorCode"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"TransactionFailureReason"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"TransactionFlag"</span><span class="token operator">:</span> <span class="token string">"@{0=duplicate - 442097,442119,442121}"</span><span class="token punctuation">,</span>
      <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"IsRefunded"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"1"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"442119"</span><span class="token punctuation">,</span>
      <span class="token comment">/* […] */</span>
      <span class="token property">"TransactionFlag"</span><span class="token operator">:</span> <span class="token string">"@{0=duplicate - 442097,442119,442121}"</span><span class="token punctuation">,</span>
      <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"IsRefunded"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"2"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"442097"</span><span class="token punctuation">,</span>
      <span class="token comment">/* […] */</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"3"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"436696"</span><span class="token punctuation">,</span>
      <span class="token comment">/* […] */</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/* […] */</span>
    <span class="token property">"340"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"418677"</span><span class="token punctuation">,</span>
      <span class="token comment">/* […] */</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"341"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"413330"</span><span class="token punctuation">,</span>
      <span class="token comment">/* […] */</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"342"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"413322"</span><span class="token punctuation">,</span>
      <span class="token comment">/* […] */</span>
      <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Webhook-notifications" tabindex="-1">Webhook notifications</h2>
<p>Alternatively, you can receive a push notification when a transaction changes status by setting up a webhook. VoPay will send a <code>POST</code> request to the endpoint you specify containing details of a transaction’s status change.</p>
<p><code>POST</code> <code>/account/webhook-url</code></p>
<!-- • client needs to provide us with their webhook url (/account/webhook-url) -->
<p>To set up a webhook, you will need to provide the URL of the webhook.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>WebHookUrl</code></td>
<td><code>string</code></td>
<td>Endpoint where you want notifications sent. Must be a valid URL.</td>
</tr>
</tbody>
</table>
<!-- • when transaction status changes, we send a notification to the webhook url -->
<p>When a transaction changes status, you will receive the status change details as JSON in a <code>POST</code> request to the URL you provided.</p>
<!-- • show what's in the webhook payload -->
<p>The payload will match the following structure:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionType"</span><span class="token operator">:</span> <span class="token string">"Interac Bulk Payout"</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token number">46166</span><span class="token punctuation">,</span>
  <span class="token property">"TransactionAmount"</span><span class="token operator">:</span> <span class="token string">"17887.00"</span><span class="token punctuation">,</span>
  <span class="token property">"Status"</span><span class="token operator">:</span> <span class="token string">"failed"</span><span class="token punctuation">,</span>
  <span class="token property">"UpdatedAt"</span><span class="token operator">:</span> <span class="token string">"2022-02-16 09:45:19"</span><span class="token punctuation">,</span>
  <span class="token property">"ValidationKey"</span><span class="token operator">:</span> <span class="token string">"ab18ccf2e3cebd5add2c3789f3cf8cb50679f70a"</span><span class="token punctuation">,</span>
  <span class="token property">"FailureReason"</span><span class="token operator">:</span> <span class="token string">"901 - NSF"</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="slate/img/HMACDiagram.jpg" alt=""></p>
<!-- • explain validation key -->
<p>The <code>ValidationKey</code> refers to the SHA1 hash of your API shared secret and the <code>TransactionID</code> in the payload. This serves a dual purpose of establishing the authenticity of the message (origin trust) and verifying the data integrity of the payload (content fidelity).</p>
<!-- • show how they can test (/account/webhook-url-test) -->
<p>To check if your webhook receiver is operational, send a <code>GET</code> request to <code>/account/webhook-url-test</code>. The <code>Success</code> field will be <code>true</code> (and <code>ErrorMessage</code> empty) if the data has been sent to your receiver.</p>
<h1 id="Scheduling-Transactions" tabindex="-1">Scheduling Transactions</h1>
<!-- Transactions can be executed right away, or can be scheduled -->
<p>Transactions can be programmatically scheduled to run at a specific (future) time, or to run on a regular schedule. This is where the advantage of API access becomes the most evident.</p>
<!-- Users can also create recurring payments -->
<!-- EFT only (for now) -->
<p>For now, you will learn how EFT transactions can be scheduled.</p>
<h2 id="Scheduling-one-time-payments" tabindex="-1">Scheduling one-time payments</h2>
<!-- • /eft/fund/schedule or /eft/withdraw/schedule -->
<p>One-time future funding or funding can be scheduled using the <code>/eft/fund/schedule</code> or <code>/eft/withdraw/schedule</code> endpoints, respectively.</p>
<!-- • essentially the same as an /eft/fund or /eft/withdraw endpoint, but with a scheduled date -->
<p>These each have essentially the same function as the <code>/eft/fund</code> and <code>/eft/withdraw</code> endpoints, but the scheduler creates transactions on the specified dates.</p>
<p><code>POST</code> <code>/eft/fund/schedule</code></p>
<p>For scheduling one-time EFT fund transactions or one-time EFT withdrawals, the following are the minimally required parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Amount</code></td>
<td><code>number</code></td>
<td>The amount to be funded</td>
</tr>
<tr>
<td><code>Frequency</code></td>
<td><code>string</code></td>
<td>How often: <code>single</code> or <code>recurring</code>. For one-time funding, you will indicate <code>single</code>.</td>
</tr>
<tr>
<td><code>ScheduleStartDate</code></td>
<td><code>string</code></td>
<td>Date to post the transaction.</td>
</tr>
</tbody>
</table>
<p><code>POST</code> <code>/eft/withdraw/schedule</code></p>
<h2 id="Scheduling-recurring-payments" tabindex="-1">Scheduling recurring payments</h2>
<!-- • /eft/fund/schedule or /eft/withdraw/schedule -->
<p><code>POST</code> <code>/eft/fund/schedule</code>
<code>POST</code> <code>/eft/withdraw/schedule</code></p>
<p>The same endpoints may be used to schedule recurring inbound or outbound transactions.</p>
<!-- • essentially the same as /eft/fund and /eft/withdraw, except we also need frequency and number of payments (or end date) -->
<p>Again, these have the same effect as <code>/eft/fund</code> and <code>/eft/withdraw</code> respectively, but with recurrence specifications. To achieve this, the following parameters are required:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Frequency</code></td>
<td><code>string</code></td>
<td>How often the transaction is re-posted: <code>single</code> or <code>recurring</code>.</td>
</tr>
<tr>
<td><code>NameOfFrequency</code></td>
<td><code>string</code></td>
<td>The recurrence periodicity: <code>weekly</code>, <code>biweekly</code>, <code>semi-monthly</code>, <code>monthly</code>, <code>bimonthly</code>, <code>3 months</code>, <code>6 months</code>, <code>yearly</code></td>
</tr>
<tr>
<td><code>ScheduleStartDate</code></td>
<td><code>string</code></td>
<td>Date on which the transactions will be started.</td>
</tr>
<tr>
<td><code>ScheduleEndDate</code></td>
<td><code>string</code></td>
<td>Date on which the transactions will be ended (only if <code>EndingAfterPayments</code> is not specified).</td>
</tr>
<tr>
<td><code>EndingAfterPayments</code></td>
<td><code>integer</code></td>
<td>Number of payments after which the transactions will be ended (only <code>ScheduleEndDate</code> is not specified).</td>
</tr>
</tbody>
</table>
<h2 id="Scheduling-an-auto-balance-transfer" tabindex="-1">Scheduling an auto-balance transfer</h2>
<!-- • /account/auto-balance-transfer -->
<p><code>POST</code> <code>/account/auto-balance-transfer</code></p>
<!-- • allows users to transfer entire balance from VoPay wallet to a bank account (i.e., it's basically a scheduled /eft/withdraw) -->
<p>This endpoint allows you to schedule an auto-balance transfer (one-time or recurring) from your VoPay wallet to a bank account. This will regularly liquidate your entire balance so that your funds remain accessible to other services  attached to your bank account.</p>
<!-- • users provide frequency and minimum amount to trigger a transfer (ex: only trigger a balance transfer if balance ❭ -->
<!-- $100) -->
<p>To use this, you must indicate the frequency and the minimum amount available to check for a transfer. For example, you can choose to make a full balance transfer only when available funds exceed $100 in your wallet’s currency.</p>
<p>The following are the minimally required parameters for this endpoint:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ScheduleStartDate</code></td>
<td><code>string</code></td>
<td>Date from which the transfer schedule will begin</td>
</tr>
<tr>
<td><code>AutoBalanceTransferAmount</code></td>
<td><code>number</code></td>
<td>The minimum amount to have in your VoPay account to initiate a scheduled transfer.</td>
</tr>
<tr>
<td><code>TypeOfFrequency</code></td>
<td><code>string</code></td>
<td>Periodicity in which to receive the transfer: <code>daily</code>, <code>weekly</code>, <code>biweekly</code>, <code>monthly</code></td>
</tr>
</tbody>
</table>
<h1 id="Aliasing-Sensitive-Data" tabindex="-1">Aliasing Sensitive Data</h1>
<p>Instead of supplying ITA details every time you issue EFTs, you can request a persistent token that authorizes current/future transactions. This simplifies your auth flow and minimizes the number of sensitive data in the requests.</p>
<p>If the customer authorizes using the bank’s web login (<strong>vetted</strong>), an iQ11 token also allows you to avoid <strong>non-sufficient funds</strong> failures for that customer. Instead, VoPay will gracefully fail any transaction lacking sufficient funds before it reaches the bank. See the section on <a href="#nsfs">NSF’s</a> for more details.</p>
<!--   - intelligent-eft-iq11.md -->
<!--   - what-is-iq11.md -->
<!--   - generating-a-manual-token.md -->
<!--   - connecting-your-bank-account-online.md -->
<!--   - paylink.md -->
<!--   - requesting-banking-info-via-paylink.md -->
<h2 id="Overview-of-Token-Use-Cases" tabindex="-1">Overview of Token Use Cases</h2>
<p>If you already have your customers’ ITA information, you can submit that in exchange for an iQ11 token. Thereafter, the token can be used in lieu of ITA for transactions.</p>
<p>If you don’t already have the ITA, you can either invite your customer to provide their banking info through VoPay’s secure web interface; or, you can embed this interface as a step within your solution. Then you would receive an associated iQ11 token when your customer uses this interface to enter ITA or authenticate with their bank.</p>
<p>The guide will elaborate on each of the above approaches.</p>
<!--   - intelligent-eft-iq11.md -->
<!--   - what-is-iq11.md -->
<!--   - generating-a-manual-token.md -->
<!--   - connecting-your-bank-account-online.md -->
<!--   - paylink.md -->
<!--   - requesting-banking-info-via-paylink.md -->
<h2 id="Manually-generating-a-token" tabindex="-1">Manually generating a token</h2>
<p>You can generate an iQ11 token manually by providing your customers’ ITA information to the <code>tokenize</code> endpoint.</p>
<!-- • /iq11/tokenize -->
<p><code>POST</code> <code>/iq11/tokenize</code></p>
<p>The following iQ11 parameters are required for Canadian banks:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AccountHolderName</code></td>
<td><code>string</code></td>
<td>Account holder’s full name.</td>
</tr>
<tr>
<td><code>AccountNumber</code></td>
<td><code>string</code></td>
<td>Customer’s bank account number for funds to be debited from.</td>
</tr>
<tr>
<td><code>FinancialInstitutionNumber</code></td>
<td><code>string</code></td>
<td>Three digit institution number for a Canadian bank.</td>
</tr>
<tr>
<td><code>BranchTransitNumber</code></td>
<td><code>string</code></td>
<td>Transit number for the customer’s account.</td>
</tr>
</tbody>
</table>
<!-- • users can now pass in this token instead of ITA info to our EFT endpoints -->
<p>The generated token can now be used instead of ITA in all the EFT transaction endpoints discussed earlier. For example, with <code>POST</code> <code>eft/fund</code>, you can now provide a single <code>Token</code> parameter instead of <code>AccountHolderName</code>, <code>AccountNumber</code>, <code>FinancialInstitutionNumber</code>, and <code>BranchTransitNumber</code>. Here is the new query string:</p>
<!-- CODE SNIPPET HERE EFT FUND WITH TOKEN IN LIEU OF ITA -->
<!--   - intelligent-eft-iq11.md -->
<!--   - what-is-iq11.md -->
<!--   - generating-a-manual-token.md -->
<!--   - connecting-your-bank-account-online.md -->
<!--   - paylink.md -->
<!--   - requesting-banking-info-via-paylink.md -->
<h2 id="Token-via-Customer-Login" tabindex="-1">Token via Customer Login</h2>
<p><code>POST</code> <code>/iq11/generate-embed-url</code></p>
<!-- generate an iFrame (/iq11/generate-embed-url) -->
<p>This endpoint generates a distributable user interface you can deploy to collect your customers’ ITA information. To use it, note the <code>EmbedURL</code> field in the response payload when you query <code>/iq11/generate-embed-url</code>.</p>
<p>This URL, uniquely associated to connect with your wallet, will look like <code>https://earthnode-dev.vopay.com/iq11/embed/&lt;UNIQUE_IDENTIFIER&gt;</code> with a 40-char <code>&lt;UNIQUE_IDENTIFIER&gt;</code>. You can embed the UI in your own solution using an <code>iframe</code> or <code>object</code>, as in this example (adapt dimensions to your needs):</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://earthnode.vopay.com/iq11/embed/a3c6bb45f2fc02478cb900bf9d3e11264b356105<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100%<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>500px<span class="token punctuation">"</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">scrolling</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="Embed-Options" tabindex="-1">Embed Options</h3>
<!-- can provide account selection methods (manual or online or both) -->
<p>The embedded <code>iframe</code> or <code>object</code> can allow your customers to authorize with their bank through the bank’s interface (vetted login using their online banking credentials); or, identify their bank and then provide an account number.</p>
<p>When you call the <code>/iq11/generate-embed-url</code> endpoint, you can specify the following options:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Language</code></td>
<td><code>string</code></td>
<td><code>en</code> (English) or <code>fr</code> (French). Default: <code>en</code></td>
</tr>
<tr>
<td><code>AccountSelectionMethod</code></td>
<td><code>string</code></td>
<td>This parameter accepts <code>any</code>, <code>online</code> and <code>manual</code>. Default: <code>any</code>.</td>
</tr>
<tr>
<td><code>RedirectMethod</code></td>
<td><code>string</code></td>
<td>This parameter accepts <code>InnerRedirect</code>, <code>OuterRedirect</code>, and <code>JavascriptMessage</code> as parameter values.</td>
</tr>
<tr>
<td><code>RedirectURL</code></td>
<td><code>string</code></td>
<td>URL to redirect to after the customer logs in to their online banking account. The bank account token will be passed as a URL query param, as in the example <a href="#">https://example.com/page?Token=<iq11token></iq11token></a></td>
</tr>
<tr>
<td><code>Version</code></td>
<td><code>string</code></td>
<td>The newer <code>v2</code> allows account selection, whereas <code>v1</code> uses <code>online</code> only.</td>
</tr>
</tbody>
</table>
<p>Below, a closer look at the last five parameters.</p>
<h4 id="AccountSelectionMethod" tabindex="-1"><code>AccountSelectionMethod</code></h4>
<p>By varying <code>AccountSelectionMethod</code>, your solution can either restrict customers to one of the above account-access provision methods (<code>online</code> or <code>manual</code>) or allow them the freedom to choose (<code>any</code>). Here is an elaboration:</p>
<table>
<thead>
<tr>
<th><code>AccountSelectionMethod</code> choice</th>
<th>How a customer provides access to their account</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>online</code></td>
<td>Directly authorizes using their bank’s login.</td>
</tr>
<tr>
<td><code>manual</code></td>
<td>Chooses a bank (which pulls up institution and transit info), then manually inputs account number.</td>
</tr>
<tr>
<td><code>any</code></td>
<td>Allows the customer to select an account from any bank.</td>
</tr>
</tbody>
</table>
<h4 id="RedirectMethod-and-RedirectURL" tabindex="-1"><code>RedirectMethod</code> and <code>RedirectURL</code></h4>
<p>How do you want your solution to process access authorization?</p>
<table>
<thead>
<tr>
<th><code>RedirectMethod</code> choice</th>
<th>After account access submission</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>InnerRedirect</code></td>
<td>The embedded context alone redirects to <code>RedirectURL</code></td>
</tr>
<tr>
<td><code>OuterRedirect</code></td>
<td>The parent context redirects to <code>RedirectURL</code></td>
</tr>
<tr>
<td><code>JavascriptMessage</code></td>
<td>The <code>iframe</code> posts a message received by the parent’s callback function by <code>addEventListener</code>.</td>
</tr>
</tbody>
</table>
<p>If you want to redirect, then you must provide a URL to redirect to. The iQ11 token will be encoded in a query parameter <code>Token=&lt;IQ11TOKEN&gt;</code> of the URL, for example:<code>https://example.com?Token=8wcscwkwc4wo4wsgcgss4kswcg0s48cc4ow4wgg8cw0og48csswko4ww0088g4c4</code></p>
<p>To use <code>JavascriptMessage</code>, in your solution, you implement a callback function for the <a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageEvent"><code>MessageEvent</code></a> your embed produces.</p>
<p>A simple callback looks like this:</p>
<pre class="language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">===</span> <span class="token string">'https://embed.vopay.com'</span> <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle iQ11 token</span>
        <span class="token keyword">const</span> iq11token <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Token<span class="token punctuation">;</span>
        <span class="token comment">// do something with iQ11 token</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>See <code>iq11eventhandler.js</code> for a more complete example.</p>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageEvent/data"><code>MessageEvent.data</code></a> your embed produces will look like this:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"Step"</span><span class="token operator">:</span> <span class="token string">"LINK"</span><span class="token punctuation">,</span>
    <span class="token property">"Token"</span><span class="token operator">:</span> <span class="token string">"8wcscwkwc4wo4wsgcgss4kswcg0s48cc4ow4wgg8cw0og48csswko4ww0088g4c4"</span><span class="token punctuation">,</span>
    <span class="token property">"Url"</span><span class="token operator">:</span> <span class="token string">"https://example.com?Token=8wcscwkwc4wo4wsgcgss4kswcg0s48cc4ow4wgg8cw0og48csswko4ww0088g4c4"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here, the <code>Token</code> represents the iQ11 token you can use in place of ITA to query the EFT endpoints. The <code>Url</code> is the URL you provided as <code>RedirectURL</code> with the <code>Token</code> as a query param.</p>
<h4 id="Version" tabindex="-1"><code>Version</code></h4>
<p>Choose <code>v2</code> as the version. We are moving legacy customers away from the <code>v1</code> parameter set — it will be removed in the future.</p>
<!-- can provide payment methods (bank or credit card or both) — we'll just focus on bank account here -->
<hr>
<!-- we return a URL which the user can embed in their app -->
<p>The response to your query will look like this:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"EmbedURL"</span><span class="token operator">:</span> <span class="token string">"https://embed-dev.vopay.com/f3240f2c26939f263a5e19381106229f148a830a"</span><span class="token punctuation">,</span>
    <span class="token property">"IframeKey"</span><span class="token operator">:</span> <span class="token string">"f3240f2c26939f263a5e19381106229f148a830a"</span>
<span class="token punctuation">}</span>
</code></pre>
<!-- The URL provides UI that takes the end-user through a journey to connect their bank account online -->
<p>The user interface your customers will use to permit access to their accounts is provisioned for  you at the <code>EmbedURL</code>.</p>
<aside class="caution"> To avoid security vulnerabilities (<a href="https://web.dev/what-is-mixed-content/" target="_blank" title="Google web.dev article on mixed content">Chrome</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" target="_blank" title="Mozilla docs on mixed content">Firefox</a>), make sure to implement an <strong>HTTPS context</strong> for the embed. </aside>
<!-- when this is done, we return a token, which can then be used in our EFT endpoints -->
<!--   - intelligent-eft-iq11.md -->
<!--   - what-is-iq11.md -->
<!--   - generating-a-manual-token.md -->
<!--   - connecting-your-bank-account-online.md -->
<!--   - paylink.md -->
<!--   - requesting-banking-info-via-paylink.md -->
<h2 id="Paylink-Invitation" tabindex="-1">Paylink Invitation</h2>
<p>A third method to acquire an iQ11 token is to use Paylink to request your customer’s ITA or banking authorization. Your customer will receive an email inviting them to provide you their banking info using VoPay’s secure graphical user interface; then, you receive an iQ11 token when they login to their bank (or, when they manually enter their ITA).</p>
<!--   - intelligent-eft-iq11.md -->
<!--   - what-is-iq11.md -->
<!--   - generating-a-manual-token.md -->
<!--   - connecting-your-bank-account-online.md -->
<!--   - paylink.md -->
<!--   - requesting-banking-info-via-paylink.md -->
<h3 id="Requesting-banking-info-via-Paylink" tabindex="-1">Requesting banking info via Paylink</h3>
<p>There are three steps to using Paylink to request your customers provide their ITA banking info, aliased as iQ11 tokens.</p>
<p>First, query <code>POST</code> at <code>/iq11/generate-embed-url</code> to set the options for the graphical web interface in which your customer will provide their ITA. You already learned this in the <a href="#embed-options">Embed Options section</a>. The response contains an <code>IframeKey</code> you will deploy in the next step — when you trigger sending the email.</p>
<!-- CODE SNIPPET HERE -->
<p><code>POST</code> <code>/eft/pay-link/beneficiary</code></p>
<p>Then, send <code>POST</code> to the <code>/eft/pay-link/beneficiary</code> endpoint to actually send the email to the customer. This email will contain a link to the VoPay graphical user interface you provisioned above.</p>
<!-- CODE SNIPPET HERE -->
<p>A representative response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">"4786"</span><span class="token punctuation">,</span>
    <span class="token property">"FirstName"</span><span class="token operator">:</span> <span class="token string">"Susan"</span><span class="token punctuation">,</span>
    <span class="token property">"LastName"</span><span class="token operator">:</span> <span class="token string">"Smith"</span><span class="token punctuation">,</span>
    <span class="token property">"Link"</span><span class="token operator">:</span> <span class="token string">"https://request.vopay.com/f515eec8739155552ea4a56f80e5edc0cdb13303"</span><span class="token punctuation">,</span>
    <span class="token property">"Status"</span><span class="token operator">:</span> <span class="token string">"pending"</span><span class="token punctuation">,</span>
    <span class="token property">"ReceiverEmailAddress"</span><span class="token operator">:</span> <span class="token string">"susan.smith@elpmaxe.moc"</span><span class="token punctuation">,</span>
    <span class="token property">"SenderEmailAddress"</span><span class="token operator">:</span> <span class="token string">"alice.algonquin@example.com"</span><span class="token punctuation">,</span>
    <span class="token property">"Note"</span><span class="token operator">:</span> <span class="token string">"SDD"</span><span class="token punctuation">,</span>
    <span class="token property">"SenderName"</span><span class="token operator">:</span> <span class="token string">"Alice Algonquin"</span><span class="token punctuation">,</span>
    <span class="token property">"ClientReferenceNumber"</span><span class="token operator">:</span> <span class="token string">"012345"</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>GET</code> <code>/eft/pay-link</code></p>
<p>Lastly, at any point after the customer provides their banking info as ITA or <strong>vetted</strong> banking login, you will either collect the iQ11 token by reading the <code>Token</code> query param on the URL; or else, poll the <code>/eft/pay-link</code> endpoint to get the iQ11 token.</p>
<!-- CODE SNIPPET HERE -->
<p>A representative response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"PaylinkRequests"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">"4786"</span><span class="token punctuation">,</span>
            <span class="token property">"FirstName"</span><span class="token operator">:</span> <span class="token string">"Susan"</span><span class="token punctuation">,</span>
            <span class="token property">"LastName"</span><span class="token operator">:</span> <span class="token string">"Smith"</span><span class="token punctuation">,</span>
            <span class="token property">"ReceiverEmailAddress"</span><span class="token operator">:</span> <span class="token string">"susan.smith@elpmaxe.moc"</span><span class="token punctuation">,</span>
            <span class="token property">"SenderName"</span><span class="token operator">:</span> <span class="token string">"Alice Algonquin"</span><span class="token punctuation">,</span>
            <span class="token property">"SenderEmailAddress"</span><span class="token operator">:</span> <span class="token string">"alice.algonquin@example.com"</span><span class="token punctuation">,</span>
            <span class="token property">"Status"</span><span class="token operator">:</span> <span class="token string">"completed"</span><span class="token punctuation">,</span>
            <span class="token property">"RequestDate"</span><span class="token operator">:</span> <span class="token string">"2022-02-24 21:53:40"</span><span class="token punctuation">,</span>
            <span class="token property">"Link"</span><span class="token operator">:</span> <span class="token string">"https://request.vopay.com/f515eec8739155552ea4a56f80e5edc0cdb13303"</span><span class="token punctuation">,</span>
            <span class="token property">"Token"</span><span class="token operator">:</span> <span class="token string">"gssoog04oo4kcwo0w8sk0wwwsckcks0og4gwwggkwccwcwcs88sow4ocowc4gwck"</span><span class="token punctuation">,</span>
            <span class="token property">"Note"</span><span class="token operator">:</span> <span class="token string">"SDD"</span><span class="token punctuation">,</span>
            <span class="token property">"ClientReferenceNumber"</span><span class="token operator">:</span> <span class="token string">"012345"</span><span class="token punctuation">,</span>
            <span class="token property">"Amount"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"Currency"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"ScheduledPaymentsID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"PaylinkRequestType"</span><span class="token operator">:</span> <span class="token string">"Beneficiary"</span><span class="token punctuation">,</span>
            <span class="token property">"Institution"</span><span class="token operator">:</span> <span class="token string">"VOPAY TESTING BANK"</span><span class="token punctuation">,</span>
            <span class="token property">"FinancialInstitutionNumber"</span><span class="token operator">:</span> <span class="token string">"999"</span><span class="token punctuation">,</span>
            <span class="token property">"BranchTransitNumber"</span><span class="token operator">:</span> <span class="token string">"99999"</span><span class="token punctuation">,</span>
            <span class="token property">"AccountNumber"</span><span class="token operator">:</span> <span class="token string">"*****9999"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Then you can use the token for all future EFT transactions for that customer.</p>
<!-- CODE SNIPPET HERE -->
<!--   - intelligent-eft-iq11.md -->
<!--   - what-is-iq11.md -->
<!--   - generating-a-manual-token.md -->
<!--   - connecting-your-bank-account-online.md -->
<!--   - paylink.md -->
<!--   - requesting-banking-info-via-paylink.md -->
<h1 id="Troubleshooting" tabindex="-1">Troubleshooting</h1>
<p>If you find transactions flagged, failing, or you otherwise have trouble querying, you may be having one of these common problems.</p>
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h2 id="When-do-transactions-fail" tabindex="-1">When do transactions fail?</h2>
<p>Transactions can fail in VoPay or they can fail at the bank. As <a href="#response-readiness">discussed earlier</a>, transactions that VoPay sends to the bank will immediately produce a <code>TransactionID</code> for you in their response. If you fail to receive a <code>TransactionID</code> for a requested transaction, it means VoPay is unable to send that transaction to the bank and a failure reason will appear in the <code>ErrorMessage</code>.</p>
<h3 id="Invalid-Account-info" tabindex="-1">Invalid Account info</h3>
<!-- if ITA info is passed into to an EFT endpoint and that info is incorrect (ie. invalid inst number, transit number or acct number), the bank will fail the transaction -->
<p>If you make a valid transaction request (you receive a <code>TransactionID</code>) with invalid account info (the provided ITA is incorrect or erroneous), the bank will fail the transaction. The bank will return an <a href="#failure">error message</a> in its eventual response to VoPay. The turnaround for this invalid ITA ranges from twenty-minutes to a few hours.</p>
<p>To avoid this, you should either <strong>use iQ11 tokens</strong> in lieu of ITA or else <strong>always check that you are supplying the correct institution number, transit number, and account number</strong> for your intended transactions.</p>
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h2 id="Common-errors" tabindex="-1">Common errors</h2>
<p>The following is a list of errors that can occur when submitting a transaction request.</p>
<table>
<thead>
<tr>
<th>Error Message</th>
<th>Description</th>
<th>Solutions</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>This Account is invalid or inactive. Please try again</code></td>
<td>The account is not yet activated, is in a pending status, or the <code>AccountID</code> field was left empty</td>
<td><a href="https://vopay.com/api-sandbox/accounts/activate">Activate your account</a></td>
</tr>
<tr>
<td><code>Unauthorized IP(s). Please contact VoPay business team at business@vopay.com</code></td>
<td>Attempt to make a request on a production endpoint from an unrecognized device</td>
<td><a href="https://vopay.com/api-sandbox/contact">Contact VoPay business team</a></td>
</tr>
<tr>
<td><code>Invalid Login. Please provide the required parameters</code></td>
<td>The <code>AccountID</code>, <code>Key</code> or <code>Signature</code> fields were incorrect or left empty</td>
<td>See <a href="#authentication">authentication</a></td>
</tr>
<tr>
<td><code>Available fund is insufficient</code></td>
<td>The wallet does not have funds available sufficient to complete the transaction</td>
<td><a href="https://vopay.com/api-sandbox/contact">Contact VoPay business team</a></td>
</tr>
<tr>
<td><code>This operation is not currently enabled for your account. Please contact VoPay business team at business@vopay.com</code></td>
<td>The account does not have permission to perform the requested action (e.g., exceeded quota/rate limits)</td>
<td><a href="https://vopay.com/api-sandbox/contact">Contact VoPay business team</a></td>
</tr>
</tbody>
</table>
<p>The above errors indicate a problem immediately provided in the response — deferred errors can occur <a href="#invalid-account-info">when the bank must notify you</a> of the problem. The latter (deferred) errors will show in your <a href="#setup-webhook-notifications">webhook notifications</a> or when you <a href="#polling-for-transaction-statuses">check the status of your transaction</a>.</p>
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h3 id="Flagged-transactions" tabindex="-1">Flagged transactions</h3>
<!-- transaction can be flagged as a duplicate -->
<p>To guard against unintended or suspicious transfers, we notify customers when we receive certain transactions requests. These transactions are flagged pending review by the customer. Choosing to clear the flag permits the transaction.</p>
<!-- EFTs -->
<h4 id="Duplicate-EFT-Transactions" tabindex="-1">Duplicate EFT Transactions</h4>
<p>We will flag an EFT transaction as a potential duplicate EFT having these conditions:</p>
<!-- two (or more) transactions with the same name, bank info, amount, and currency within 3 hours -->
<ul>
<li>Within 3 hours of the original fund/withdraw transaction, another fund/withdraw having the same
<ul>
<li>Name</li>
<li>Bank account</li>
<li>Amount</li>
<li>Currency</li>
</ul>
</li>
</ul>
<!-- Interac -->
<h4 id="Duplicate-Interac-Transfer" tabindex="-1">Duplicate Interac Transfer</h4>
<!-- two (or more) transactions with the same amount, email address, and currency within 3 hours -->
<p>Interac transfer will be flagged as potentially duplicate <code>payout</code>/<code>money-request</code> when:</p>
<ul>
<li>Within 3 hours of the original transaction, another having the same
<ul>
<li>Email address</li>
<li>Amount</li>
<li>Currency</li>
</ul>
</li>
</ul>
<h4 id="Clearing-the-flag" tabindex="-1">Clearing the flag</h4>
<p>As you learned in <a href="#polling-for-transaction-statuses">the section on status polling</a>, you may find flagged EFT/Interac transactions by providing <code>StartDateTime</code> and <code>EndDateTime</code> (both in <code>YYYY-MM-DD HH:MM:SS</code> or <code>YYYY-MM-DD</code> format) in a <code>GET</code> on <code>account/transactions</code>. The <code>TransactionFlag</code> field will show the flag reason (e.g., <code>duplicate</code>) followed by a list correspondingly flagged transaction IDs (where applicable).</p>
<!-- CODE SNIPPET -->
<p>Here is a representative response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"Success"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"ErrorMessage"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"NumberOfRecords"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"Transactions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"460166"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionDateTime"</span><span class="token operator">:</span> <span class="token string">"2022-02-25 00:21:33"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionType"</span><span class="token operator">:</span> <span class="token string">"EFT Funding"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionStatus"</span><span class="token operator">:</span> <span class="token string">"pending"</span><span class="token punctuation">,</span>
            <span class="token comment">/* […] */</span>
            <span class="token property">"TransactionFlag"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"0"</span><span class="token operator">:</span> <span class="token string">"duplicate - 460154,460160,460165,460166"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"IsRefunded"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"1"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"460165"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionDateTime"</span><span class="token operator">:</span> <span class="token string">"2022-02-25 00:21:28"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionType"</span><span class="token operator">:</span> <span class="token string">"EFT Funding"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionStatus"</span><span class="token operator">:</span> <span class="token string">"pending"</span><span class="token punctuation">,</span>
            <span class="token comment">/* […] */</span>
            <span class="token property">"TransactionFlag"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"0"</span><span class="token operator">:</span> <span class="token string">"duplicate - 460154,460160,460165,460166"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"IsRefunded"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"2"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"TransactionID"</span><span class="token operator">:</span> <span class="token string">"460160"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionDateTime"</span><span class="token operator">:</span> <span class="token string">"2022-02-25 00:18:39"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionType"</span><span class="token operator">:</span> <span class="token string">"EFT Funding"</span><span class="token punctuation">,</span>
            <span class="token property">"TransactionStatus"</span><span class="token operator">:</span> <span class="token string">"pending"</span><span class="token punctuation">,</span>
            <span class="token comment">/* […] */</span>
            <span class="token property">"TransactionFlag"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"0"</span><span class="token operator">:</span> <span class="token string">"duplicate - 460154,460160,460165,460166"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"PaylinkRequestID"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"IsRefunded"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"FullName"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>POST</code> <code>/account/transaction/confirm</code></p>
<p>Call <code>POST</code> on <code>/account/transaction/confirm</code> with the <code>TransactionID</code> (<code>integer</code>) to clear a flagged transaction, thereby allowing it to be processed.</p>
<!-- CODE SNIPPET -->
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h3 id="NSFs" tabindex="-1">NSFs</h3>
<!-- transaction can fail due to NSF -->
<p>Funding transactions can fail when the bank account lacks a balance sufficient to clear the transaction. When the bank attempts to draw funds for the transaction, the bank itself will fail this transaction as <strong>non-sufficient funds</strong> (NSF) .</p>
<p>VoPay helps you avoid NSF failures using iQ11. If you supply a vetted iQ11 token, VoPay will fail a transaction before it reaches the bank when it would have otherwise produced an NSF</p>
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h3 id="NSF-checks" tabindex="-1">NSF checks</h3>
<!-- when providing an iq11 token we can connect to the bank account and check if the funds are available before processing the transaction -->
<p>Another advantage of using the iQ11 token is avoiding <strong>non-sufficient funds</strong> failures. When supplying a vetted iQ11 token and the bank account does not have the required funds, VoPay will fail the transaction before it reaches the bank.</p>
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h3 id="Invalid-Account-info" tabindex="-1">Invalid Account info</h3>
<!-- if ITA info is passed into to an EFT endpoint and that info is incorrect (ie. invalid inst number, transit number or acct number), the bank will fail the transaction -->
<p>If you make a valid API call with invalid account info, the bank will fail the transaction. This can happen when you provide incorrect or erroneous ITA that the endpoint does not reject. The bank will return an <a href="#failure">error message</a> in its eventual response to VoPay.</p>
<p>To avoid this, you should either <strong>use iQ11 tokens</strong> in lieu of ITA or else <strong>always check that you are supplying the correct institution number, transit number, and account number</strong> for your intended transactions.</p>
<!--   - troubleshooting.md -->
<!--   - when-do-transactions-fail.md -->
<!--   - common-errors.md -->
<!--   - flagged-transactions.md -->
<!--   - nsfs.md -->
<!--   - nsf-checks.md -->
<!--   - invalid-account-info.md -->
<!--   - other-errors.md -->
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<h2 id="Other-errors" tabindex="-1">Other errors</h2>
<h1 id="Meta-transaction-requests" tabindex="-1">Meta-transaction requests</h1>
<p>Requests aimed at regulating transactions that are already pending, in progress, or completed, can be useful in a number of cases. In addition to polling for status updates, you may find need of cancelling, refunding, or clearing a transaction.</p>
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<!--   - client-accounts.md -->
<!--   - what-are-client-accounts-and-how-can-we-use-them.md -->
<h2 id="Cancel" tabindex="-1">Cancel</h2>
<p><code>POST</code> <code>/account/transaction/cancel</code></p>
<!--   - other-transaction-requests.md -->
<!--   - cancel.md -->
<!--   - refund.md -->
<!--   - removing-flags.md -->
<!--   - client-accounts.md -->
<!--   - what-are-client-accounts-and-how-can-we-use-them.md -->
<h2 id="Refund" tabindex="-1">Refund</h2>
<h2 id="Removing-Flags" tabindex="-1">Removing Flags</h2>
<h1 id="Client-Accounts" tabindex="-1">Client Accounts</h1>
<h2 id="What-are-client-accounts-and-how-can-we-use-them" tabindex="-1">What are client accounts and how can we use them</h2>

      </div>
      <div class="dark-box">
        
          <div class="lang-selector">
            
              
                <a href="#" data-language-name="powershell">powershell</a>
              
            
              
                <a href="#" data-language-name="shell">shell</a>
              
            
              
                <a href="#" data-language-name="ruby">ruby</a>
              
            
              
                <a href="#" data-language-name="python">python</a>
              
            
              
                <a href="#" data-language-name="php">php</a>
              
            
              
                <a href="#" data-language-name="csharp">csharp</a>
              
            
              
                <a href="#" data-language-name="javascript">javascript</a>
              
            
              
                <a href="#" data-language-name="java">java</a>
              
            
              
                <a href="#" data-language-name="go">go</a>
              
            
          </div>
        
      </div>
    </div>
  

</body></html>